<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Bevy XPBD"><title>bevy_xpbd_2d - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceSerif4-Regular-46f98efaafac5295.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/FiraSans-Regular-018c141bf0843ffd.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/FiraSans-Medium-8f9a781e4970d388.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2"><link rel="stylesheet" href="../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../static.files/rustdoc-5bc39a1768837dd0.css"><meta name="rustdoc-vars" data-root-path="../" data-static-root-path="../static.files/" data-current-crate="bevy_xpbd_2d" data-themes="" data-resource-suffix="" data-rustdoc-version="1.77.1 (7cf61ebde 2024-03-27)" data-channel="1.77.1" data-search-js="search-dd67cee4cfa65049.js" data-settings-js="settings-4313503d2e1961c2.js" ><script src="../static.files/storage-4c98445ec4002617.js"></script><script defer src="../crates.js"></script><script defer src="../static.files/main-48f368f3872407c8.js"></script><noscript><link rel="stylesheet" href="../static.files/noscript-04d5337699b92874.css"></noscript><link rel="alternate icon" type="image/png" href="../static.files/favicon-16x16-8b506e7a72182f1c.png"><link rel="alternate icon" type="image/png" href="../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc mod crate"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle" title="show sidebar"></button></nav><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../bevy_xpbd_2d/index.html">bevy_xpbd_2d</a><span class="version">0.4.2</span></h2></div><div class="sidebar-elems"><ul class="block">
            <li><a id="all-types" href="all.html">All Items</a></li></ul><section><ul class="block"><li><a href="#reexports">Re-exports</a></li><li><a href="#modules">Modules</a></li><li><a href="#structs">Structs</a></li><li><a href="#enums">Enums</a></li></ul></section></div></nav><div class="sidebar-resizer"></div>
    <main><div class="width-limiter"><nav class="sub"><form class="search-form"><span></span><div id="sidebar-button" tabindex="-1"><a href="../bevy_xpbd_2d/all.html" title="show sidebar"></a></div><input class="search-input" name="search" aria-label="Run search in the documentation" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><div id="help-button" tabindex="-1"><a href="../help.html" title="help">?</a></div><div id="settings-menu" tabindex="-1"><a href="../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../static.files/wheel-7b819b6101059cd0.svg"></a></div></form></nav><section id="main-content" class="content"><div class="main-heading"><h1>Crate <a class="mod" href="#">bevy_xpbd_2d</a><button id="copy-path" title="Copy item path to clipboard"><img src="../static.files/clipboard-7571035ce49a181d.svg" width="19" height="18" alt="Copy item path"></button></h1><span class="out-of-band"><a class="src" href="../src/bevy_xpbd_2d/lib.rs.html#1-783">source</a> · <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><h2 id="bevy-xpbd"><a class="doc-anchor" href="#bevy-xpbd">§</a>Bevy XPBD</h2>
<p><strong>Bevy XPBD</strong> is a 2D and 3D physics engine based on
<a href="#what-is-xpbd"><em>Extended Position Based Dynamics</em> (XPBD)</a> for
the <a href="https://bevyengine.org/">Bevy game engine</a>.</p>
<p>Check out the <a href="https://github.com/Jondolf/bevy_xpbd">GitHub repository</a>
for more information about the design, read the <a href="#getting-started">Getting started</a>
guide below to get up to speed, and take a look at the <a href="#table-of-contents">Table of contents</a>
for an overview of the engine’s features and their documentation.</p>
<p>You can also check out the <a href="#frequently-asked-questions">FAQ</a>, and if you encounter
any further problems, consider saying hello on the <a href="https://discord.gg/bevy">Bevy Discord</a>!</p>
<h3 id="getting-started"><a class="doc-anchor" href="#getting-started">§</a>Getting started</h3>
<p>This short guide should help you get started with Bevy XPBD.</p>
<h4 id="add-the-dependency"><a class="doc-anchor" href="#add-the-dependency">§</a>Add the dependency</h4>
<p>First, add <code>bevy_xpbd_2d</code> or <code>bevy_xpbd_3d</code> to the dependencies in your <code>Cargo.toml</code>:</p>
<div class="example-wrap"><pre class="language-toml"><code># For 2D applications:
[dependencies]
bevy_xpbd_2d = &quot;0.4&quot;

# For 3D applications:
[dependencies]
bevy_xpbd_3d = &quot;0.4&quot;

# If you want to use the most up-to-date version, you can follow the main branch:
[dependencies]
bevy_xpbd_3d = { git = &quot;https://github.com/Jondolf/bevy_xpbd&quot;, branch = &quot;main&quot; }
</code></pre></div>
<p>You can specify features by disabling the default features and manually adding
the feature flags you want:</p>
<div class="example-wrap"><pre class="language-toml"><code>[dependencies]
# Add 3D Bevy XPBD with double-precision floating point numbers.
# `parry-f64` enables collision detection using Parry.
bevy_xpbd_3d = { version = &quot;0.4&quot;, default-features = false, features = [&quot;3d&quot;, &quot;f64&quot;, &quot;parry-f64&quot;] }
</code></pre></div><h4 id="feature-flags"><a class="doc-anchor" href="#feature-flags">§</a>Feature flags</h4><div><table><thead><tr><th>Feature</th><th>Description</th><th>Default feature</th></tr></thead><tbody>
<tr><td><code>2d</code></td><td>Enables 2D physics. Incompatible with <code>3d</code>.</td><td>Yes (<code>bevy_xpbd_2d</code>)</td></tr>
<tr><td><code>3d</code></td><td>Enables 3D physics. Incompatible with <code>2d</code>.</td><td>Yes (<code>bevy_xpbd_3d</code>)</td></tr>
<tr><td><code>f32</code></td><td>Enables <code>f32</code> precision for physics. Incompatible with <code>f64</code>.</td><td>Yes</td></tr>
<tr><td><code>f64</code></td><td>Enables <code>f64</code> precision for physics. Incompatible with <code>f32</code>.</td><td>No</td></tr>
<tr><td><code>default-collider</code></td><td>Enables the default <a href="plugins/collision/struct.Collider.html" title="struct bevy_xpbd_2d::plugins::collision::Collider"><code>Collider</code></a>. Required for <a href="plugins/spatial_query/index.html" title="mod bevy_xpbd_2d::plugins::spatial_query">spatial queries</a>. Requires either the <code>parry-f32</code> or <code>parry-f64</code> feature.</td><td>Yes</td></tr>
<tr><td><code>parry-f32</code></td><td>Enables the <code>f32</code> version of the Parry collision detection library. Also enables the <code>default-collider</code> feature.</td><td>Yes</td></tr>
<tr><td><code>parry-f64</code></td><td>Enables the <code>f64</code> version of the Parry collision detection library. Also enables the <code>default-collider</code> feature.</td><td>No</td></tr>
<tr><td><code>debug-plugin</code></td><td>Enables physics debug rendering using the <a href="plugins/debug/struct.PhysicsDebugPlugin.html" title="struct bevy_xpbd_2d::plugins::debug::PhysicsDebugPlugin"><code>PhysicsDebugPlugin</code></a>. The plugin must be added separately.</td><td>Yes</td></tr>
<tr><td><code>enhanced-determinism</code></td><td>Enables increased determinism.</td><td>No</td></tr>
<tr><td><code>parallel</code></td><td>Enables some extra multithreading, which improves performance for larger simulations but can add some overhead for smaller ones.</td><td>Yes</td></tr>
<tr><td><code>simd</code></td><td>Enables <a href="https://en.wikipedia.org/wiki/Single_instruction,_multiple_data">SIMD</a> optimizations.</td><td>No</td></tr>
<tr><td><code>serialize</code></td><td>Enables support for serialization and deserialization using Serde.</td><td>No</td></tr>
</tbody></table>
</div><h4 id="install-the-plugin"><a class="doc-anchor" href="#install-the-plugin">§</a>Install the plugin</h4>
<p>Bevy XPBD is designed to be very modular. It is built from several <a href="plugins/index.html" title="mod bevy_xpbd_2d::plugins">plugins</a> that
manage different parts of the engine. These plugins can be easily initialized and configured through
the <a href="plugins/struct.PhysicsPlugins.html" title="struct bevy_xpbd_2d::plugins::PhysicsPlugins"><code>PhysicsPlugins</code></a> plugin group.</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">use </span>bevy::prelude::<span class="kw-2">*</span>;
<span class="kw">use </span>bevy_xpbd_2d::prelude::<span class="kw-2">*</span>;

<span class="kw">fn </span>main() {
    App::new()
        .add_plugins((DefaultPlugins, PhysicsPlugins::default()))
        <span class="comment">// ...your other plugins, systems and resources
        </span>.run();
}</code></pre></div>
<p>Now you can use all of Bevy XPBD’s <a href="components/index.html" title="mod bevy_xpbd_2d::components">components</a> and <a href="resources/index.html" title="mod bevy_xpbd_2d::resources">resources</a> to build whatever you want!</p>
<p>For example, adding a <a href="components/enum.RigidBody.html" title="enum bevy_xpbd_2d::components::RigidBody">rigid body</a> with a <a href="plugins/collision/struct.Collider.html" title="struct bevy_xpbd_2d::plugins::collision::Collider">collider</a> is as simple as spawning an entity
with the <a href="components/enum.RigidBody.html" title="enum bevy_xpbd_2d::components::RigidBody"><code>RigidBody</code></a> and <a href="plugins/collision/struct.Collider.html" title="struct bevy_xpbd_2d::plugins::collision::Collider"><code>Collider</code></a> components:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">use </span>bevy::prelude::<span class="kw-2">*</span>;
<span class="kw">use </span>bevy_xpbd_2d::prelude::<span class="kw-2">*</span>;

<span class="kw">fn </span>setup(<span class="kw-2">mut </span>commands: Commands) {
    commands.spawn((RigidBody::Dynamic, Collider::circle(<span class="number">0.5</span>)));
}</code></pre></div>
<p>You can find lots of <a href="https://github.com/Jondolf/bevy_xpbd#more-examples">usage examples</a>
in the project’s <a href="https://github.com/Jondolf/bevy_xpbd">repository</a>.</p>
<h3 id="table-of-contents"><a class="doc-anchor" href="#table-of-contents">§</a>Table of contents</h3>
<p>Below is a structured overview of the documentation for the various
features of the engine.</p>
<h4 id="rigid-bodies"><a class="doc-anchor" href="#rigid-bodies">§</a>Rigid bodies</h4>
<ul>
<li><a href="components/enum.RigidBody.html#rigid-body-types" title="enum bevy_xpbd_2d::components::RigidBody">Rigid body types</a></li>
<li><a href="components/enum.RigidBody.html#creation" title="enum bevy_xpbd_2d::components::RigidBody">Creating rigid bodies</a></li>
<li><a href="components/enum.RigidBody.html#movement" title="enum bevy_xpbd_2d::components::RigidBody">Movement</a>
<ul>
<li><a href="components/struct.LinearVelocity.html" title="struct bevy_xpbd_2d::components::LinearVelocity">Linear</a> and <a href="components/struct.AngularVelocity.html" title="struct bevy_xpbd_2d::components::AngularVelocity">angular</a> velocity</li>
<li><a href="components/struct.ExternalForce.html" title="struct bevy_xpbd_2d::components::ExternalForce">Forces</a>, <a href="components/struct.ExternalTorque.html" title="struct bevy_xpbd_2d::components::ExternalTorque">torque</a>, and <a href="components/struct.ExternalImpulse.html" title="struct bevy_xpbd_2d::components::ExternalImpulse">linear</a> and <a href="components/struct.ExternalAngularImpulse.html" title="struct bevy_xpbd_2d::components::ExternalAngularImpulse">angular</a> impulses</li>
</ul>
</li>
<li><a href="resources/struct.Gravity.html" title="struct bevy_xpbd_2d::resources::Gravity">Gravity</a> and <a href="components/struct.GravityScale.html" title="struct bevy_xpbd_2d::components::GravityScale">gravity scale</a></li>
<li><a href="components/enum.RigidBody.html#mass-properties" title="enum bevy_xpbd_2d::components::RigidBody">Mass properties</a></li>
<li><a href="components/struct.LinearDamping.html" title="struct bevy_xpbd_2d::components::LinearDamping">Linear</a> and <a href="components/struct.AngularDamping.html" title="struct bevy_xpbd_2d::components::AngularDamping">angular</a> velocity damping</li>
<li><a href="components/struct.LockedAxes.html" title="struct bevy_xpbd_2d::components::LockedAxes">Lock translational and rotational axes</a></li>
<li><a href="components/struct.Dominance.html" title="struct bevy_xpbd_2d::components::Dominance">Dominance</a></li>
<li><a href="components/struct.Sleeping.html" title="struct bevy_xpbd_2d::components::Sleeping">Automatic deactivation with sleeping</a></li>
</ul>
<h4 id="collision-detection"><a class="doc-anchor" href="#collision-detection">§</a>Collision detection</h4>
<ul>
<li><a href="plugins/collision/struct.Collider.html" title="struct bevy_xpbd_2d::plugins::collision::Collider">Colliders</a>
<ul>
<li><a href="plugins/collision/struct.Collider.html#creation" title="struct bevy_xpbd_2d::plugins::collision::Collider">Creation</a></li>
<li><a href="components/struct.ColliderDensity.html" title="struct bevy_xpbd_2d::components::ColliderDensity">Density</a></li>
<li><a href="components/struct.Friction.html" title="struct bevy_xpbd_2d::components::Friction">Friction</a> and <a href="components/struct.Restitution.html" title="struct bevy_xpbd_2d::components::Restitution">restitution</a> (bounciness)</li>
<li><a href="components/struct.CollisionLayers.html" title="struct bevy_xpbd_2d::components::CollisionLayers">Collision layers</a></li>
<li><a href="plugins/collision/struct.Sensor.html" title="struct bevy_xpbd_2d::plugins::collision::Sensor">Sensors</a></li>
</ul>
</li>
<li><a href="plugins/collision/struct.CollidingEntities.html" title="struct bevy_xpbd_2d::plugins::collision::CollidingEntities">Get colliding entities</a></li>
<li><a href="plugins/collision/contact_reporting/struct.ContactReportingPlugin.html#collision-events" title="struct bevy_xpbd_2d::plugins::collision::contact_reporting::ContactReportingPlugin">Collision events</a></li>
<li><a href="plugins/collision/struct.Collisions.html" title="struct bevy_xpbd_2d::plugins::collision::Collisions">Accessing, filtering and modifying collisions</a></li>
<li><a href="plugins/collision/contact_query/index.html" title="mod bevy_xpbd_2d::plugins::collision::contact_query">Manual contact queries</a></li>
</ul>
<h4 id="constraints-and-joints"><a class="doc-anchor" href="#constraints-and-joints">§</a>Constraints and joints</h4>
<ul>
<li><a href="constraints/index.html" title="mod bevy_xpbd_2d::constraints">Constraints</a> (advanced)</li>
<li><a href="constraints/joints/index.html" title="mod bevy_xpbd_2d::constraints::joints">Joints</a>
<ul>
<li><a href="constraints/joints/struct.FixedJoint.html" title="struct bevy_xpbd_2d::constraints::joints::FixedJoint">Fixed joint</a></li>
<li><a href="constraints/joints/struct.DistanceJoint.html" title="struct bevy_xpbd_2d::constraints::joints::DistanceJoint">Distance joint</a></li>
<li><a href="constraints/joints/struct.PrismaticJoint.html" title="struct bevy_xpbd_2d::constraints::joints::PrismaticJoint">Prismatic joint</a></li>
<li><a href="constraints/joints/struct.RevoluteJoint.html" title="struct bevy_xpbd_2d::constraints::joints::RevoluteJoint">Revolute joint</a></li>
<li><a href="constraints/joints/struct.SphericalJoint.html" title="struct bevy_xpbd_2d::constraints::joints::SphericalJoint">Spherical joint</a></li>
</ul>
</li>
</ul>
<p>Joint motors and articulations are not supported yet, but they will be implemented in a future release.</p>
<h4 id="spatial-queries"><a class="doc-anchor" href="#spatial-queries">§</a>Spatial queries</h4>
<ul>
<li><a href="plugins/spatial_query/index.html" title="mod bevy_xpbd_2d::plugins::spatial_query">Spatial query types</a>
<ul>
<li><a href="plugins/spatial_query/index.html#raycasting" title="mod bevy_xpbd_2d::plugins::spatial_query">Raycasting</a> and <a href="plugins/spatial_query/struct.RayCaster.html" title="struct bevy_xpbd_2d::plugins::spatial_query::RayCaster"><code>RayCaster</code></a></li>
<li><a href="plugins/spatial_query/index.html#shapecasting" title="mod bevy_xpbd_2d::plugins::spatial_query">Shapecasting</a> and <a href="plugins/spatial_query/struct.ShapeCaster.html" title="struct bevy_xpbd_2d::plugins::spatial_query::ShapeCaster"><code>ShapeCaster</code></a></li>
<li><a href="plugins/spatial_query/index.html#point-projection" title="mod bevy_xpbd_2d::plugins::spatial_query">Point projection</a></li>
<li><a href="plugins/spatial_query/index.html#intersection-tests" title="mod bevy_xpbd_2d::plugins::spatial_query">Intersection tests</a></li>
</ul>
</li>
<li><a href="plugins/spatial_query/struct.SpatialQueryFilter.html" title="struct bevy_xpbd_2d::plugins::spatial_query::SpatialQueryFilter">Spatial query filters</a></li>
<li><a href="plugins/spatial_query/struct.SpatialQuery.html" title="struct bevy_xpbd_2d::plugins::spatial_query::SpatialQuery">The <code>SpatialQuery</code> system parameter</a></li>
</ul>
<h4 id="configuration"><a class="doc-anchor" href="#configuration">§</a>Configuration</h4>
<ul>
<li><a href="resources/struct.Gravity.html" title="struct bevy_xpbd_2d::resources::Gravity">Gravity</a></li>
<li><a href="plugins/setup/struct.Physics.html#usage" title="struct bevy_xpbd_2d::plugins::setup::Physics">Physics timestep</a></li>
<li><a href="plugins/setup/struct.Physics.html#physics-speed" title="struct bevy_xpbd_2d::plugins::setup::Physics">Physics speed</a></li>
<li><a href="resources/struct.SubstepCount.html" title="struct bevy_xpbd_2d::resources::SubstepCount">Configure simulation fidelity with substeps</a></li>
<li><a href="plugins/debug/struct.PhysicsDebugPlugin.html" title="struct bevy_xpbd_2d::plugins::debug::PhysicsDebugPlugin">Render physics objects for debugging</a></li>
</ul>
<h4 id="scheduling"><a class="doc-anchor" href="#scheduling">§</a>Scheduling</h4>
<ul>
<li><a href="plugins/setup/struct.PhysicsSetupPlugin.html#schedules-and-sets" title="struct bevy_xpbd_2d::plugins::setup::PhysicsSetupPlugin">Schedules and sets</a>
<ul>
<li><a href="enum.PhysicsSet.html" title="enum bevy_xpbd_2d::PhysicsSet"><code>PhysicsSet</code></a></li>
<li><a href="struct.PhysicsSchedule.html" title="struct bevy_xpbd_2d::PhysicsSchedule"><code>PhysicsSchedule</code></a> and <a href="enum.PhysicsStepSet.html" title="enum bevy_xpbd_2d::PhysicsStepSet"><code>PhysicsStepSet</code></a></li>
<li><a href="struct.SubstepSchedule.html" title="struct bevy_xpbd_2d::SubstepSchedule"><code>SubstepSchedule</code></a> and <a href="enum.SubstepSet.html" title="enum bevy_xpbd_2d::SubstepSet"><code>SubstepSet</code></a></li>
<li><a href="struct.PostProcessCollisions.html" title="struct bevy_xpbd_2d::PostProcessCollisions"><code>PostProcessCollisions</code></a> schedule</li>
<li>[<code>PrepareSet</code>]</li>
</ul>
</li>
<li><a href="plugins/struct.PhysicsPlugins.html#custom-schedule" title="struct bevy_xpbd_2d::plugins::PhysicsPlugins">Configure the schedule used for running physics</a></li>
<li><a href="plugins/setup/struct.Physics.html#pausing-resuming-and-stepping-physics" title="struct bevy_xpbd_2d::plugins::setup::Physics">Pausing, resuming and stepping physics</a></li>
<li><a href="#can-the-engine-be-used-on-servers">Usage on servers</a></li>
</ul>
<h4 id="architecture"><a class="doc-anchor" href="#architecture">§</a>Architecture</h4>
<ul>
<li><a href="plugins/struct.PhysicsPlugins.html" title="struct bevy_xpbd_2d::plugins::PhysicsPlugins">List of plugins and their responsibilities</a></li>
<li><a href="#what-is-xpbd">What is Extended Position Based Dynamics?</a></li>
<li>Extending and modifying the engine
<ul>
<li><a href="plugins/struct.PhysicsPlugins.html#custom-plugins" title="struct bevy_xpbd_2d::plugins::PhysicsPlugins">Custom plugins</a></li>
<li><a href="constraints/index.html#custom-constraints" title="mod bevy_xpbd_2d::constraints">Custom constraints</a></li>
<li><a href="constraints/joints/index.html#custom-joints" title="mod bevy_xpbd_2d::constraints::joints">Custom joints</a></li>
</ul>
</li>
</ul>
<h3 id="frequently-asked-questions"><a class="doc-anchor" href="#frequently-asked-questions">§</a>Frequently asked questions</h3>
<ul>
<li><a href="#how-does-bevy-xpbd-compare-to-rapier-and-bevy_rapier">How does Bevy XPBD compare to Rapier and bevy_rapier?</a></li>
<li><a href="#why-is-nothing-happening">Why is nothing happening?</a></li>
<li><a href="#why-is-everything-moving-so-slowly">Why is everything moving so slowly?</a></li>
<li><a href="#why-did-my-rigid-body-suddenly-vanish">Why did my rigid body suddenly vanish?</a></li>
<li><a href="#why-is-performance-so-bad">Why is performance so bad?</a></li>
<li><a href="#why-does-my-camera-following-jitter">Why does my camera following jitter?</a></li>
<li><a href="#is-there-a-character-controller">Is there a character controller?</a></li>
<li><a href="#why-are-there-separate-position-and-rotation-components">Why are there separate <code>Position</code> and <code>Rotation</code> components?</a></li>
<li><a href="#can-the-engine-be-used-on-servers">Can the engine be used on servers?</a></li>
<li><a href="#something-else">Something else?</a></li>
</ul>
<h4 id="how-does-bevy-xpbd-compare-to-rapier-and-bevy_rapier"><a class="doc-anchor" href="#how-does-bevy-xpbd-compare-to-rapier-and-bevy_rapier">§</a>How does Bevy XPBD compare to Rapier and bevy_rapier?</h4>
<p>Rapier is the biggest and most used physics engine in the Rust ecosystem, and it is currently
the most mature and feature-rich option.</p>
<p><code>bevy_rapier</code> is a great physics integration for Bevy, but it does have several problems:</p>
<ul>
<li>It has to maintain a separate physics world and synchronize a ton of data with Bevy each frame</li>
<li>The source code is difficult to inspect, as the vast majority of it is glue code and wrappers
for Bevy</li>
<li>It has poor docs.rs documentation, and the documentation on rapier.rs is often outdated and
missing features</li>
<li>It is hard to extend as it’s not very modular or composable in design</li>
<li>Overall, it doesn’t have a native ECS-like feel outside of its public API</li>
</ul>
<p>Bevy XPBD on the other hand is built <em>for</em> Bevy <em>with</em> Bevy, and it uses the ECS for both the internals
and the public API. This removes the need for a separate physics world, reduces overhead, and makes
the source code much more approachable and easy to inspect for Bevy users.</p>
<p>In part thanks to Bevy’s modular architecture and the ECS, Bevy XPBD is also highly composable,
as it consists of several independent plugins and provides lots of options for configuration and extensions,
from <a href="plugins/struct.PhysicsPlugins.html#custom-schedule" title="struct bevy_xpbd_2d::plugins::PhysicsPlugins">custom schedules</a> and <a href="plugins/struct.PhysicsPlugins.html#custom-plugins" title="struct bevy_xpbd_2d::plugins::PhysicsPlugins">plugins</a> to
<a href="constraints/joints/index.html#custom-joints" title="mod bevy_xpbd_2d::constraints::joints">custom joints</a> and <a href="constraints/index.html#custom-constraints" title="mod bevy_xpbd_2d::constraints">constraints</a>.</p>
<p>In terms of the physics implementation, Rapier uses an impulse/velocity based solver, while Bevy XPBD uses
<a href="#what-is-xpbd">Extended Position Based Dynamics</a>. On paper, XPBD should be more stable and robust,
but it hasn’t been widely adopted in mainstream usage yet.</p>
<p>One of the biggest disadvantages of Bevy XPBD is that it is still very young, so it can have lots of bugs,
some missing features, and fewer community resources and third party crates. However, it is growing quite
rapidly, and it is already pretty close to feature-parity with Rapier.</p>
<p>At the end of the day, both engines are very solid options. If you are looking for a more mature and tested
physics integration, <code>bevy_rapier</code> is the better choice, but if you prefer an engine with less overhead
and a more native Bevy integration, consider using Bevy XPBD. Their core APIs are also quite similar,
so switching between them should be straightforward.</p>
<h4 id="why-is-nothing-happening"><a class="doc-anchor" href="#why-is-nothing-happening">§</a>Why is nothing happening?</h4>
<p>Make sure you have added the <a href="plugins/struct.PhysicsPlugins.html" title="struct bevy_xpbd_2d::plugins::PhysicsPlugins"><code>PhysicsPlugins</code></a> plugin group and you have given your rigid bodies
a <a href="components/enum.RigidBody.html" title="enum bevy_xpbd_2d::components::RigidBody"><code>RigidBody</code></a> component. See the <a href="#getting-started">getting started</a> section.</p>
<h4 id="why-is-everything-moving-so-slowly"><a class="doc-anchor" href="#why-is-everything-moving-so-slowly">§</a>Why is everything moving so slowly?</h4>
<p>If your application is in 2D, you might be using pixels as length units. This will require you to use
larger velocities and forces than you would in 3D. Make sure you set <a href="resources/struct.Gravity.html" title="struct bevy_xpbd_2d::resources::Gravity"><code>Gravity</code></a> to some larger value
as well, because its magnitude is 9.81 by default, which is tiny in pixels.</p>
<p>Bevy XPBD doesn’t have a “physics scale” yet, but it will most likely be added in the future
so that it’s possible to define some kind of pixels per meter configuration.</p>
<h4 id="why-did-my-rigid-body-suddenly-vanish"><a class="doc-anchor" href="#why-did-my-rigid-body-suddenly-vanish">§</a>Why did my rigid body suddenly vanish?</h4>
<p>Make sure to <a href="components/enum.RigidBody.html#adding-mass-properties" title="enum bevy_xpbd_2d::components::RigidBody">give your rigid bodies some mass</a>, either by adding a <a href="plugins/collision/struct.Collider.html" title="struct bevy_xpbd_2d::plugins::collision::Collider"><code>Collider</code></a>
or a <a href="components/struct.MassPropertiesBundle.html" title="struct bevy_xpbd_2d::components::MassPropertiesBundle"><code>MassPropertiesBundle</code></a>. If your bodies don’t have any mass, any physical interaction is likely to
instantly give them infinite velocity.</p>
<p>Bevy XPBD should automatically print warnings when it detects bodies with an invalid mass or inertia.</p>
<h4 id="why-is-performance-so-bad"><a class="doc-anchor" href="#why-is-performance-so-bad">§</a>Why is performance so bad?</h4>
<p>Make sure you are building your project in release mode using <code>cargo build --release</code>.</p>
<p>You can further optimize builds by setting the number of codegen units in your <code>Cargo.toml</code> to 1,
although this will also increase build times.</p>
<div class="example-wrap"><pre class="language-toml"><code>[profile.release]
codegen-units = 1
</code></pre></div>
<p>Note that Bevy XPBD simply isn’t very optimized yet, and it mostly runs on a single thread for now.
This will be addressed in future releases.</p>
<h4 id="why-does-my-camera-following-jitter"><a class="doc-anchor" href="#why-does-my-camera-following-jitter">§</a>Why does my camera following jitter?</h4>
<p>When you write a system that makes the camera follow a physics entity, you might notice some jitter.</p>
<p>To fix this, the system needs to:</p>
<ul>
<li>Run after physics so that it has the up-to-date position of the player.</li>
<li>Run before transform propagation so that your changes to the camera’s <code>Transform</code> are written
to the camera’s <code>GlobalTransform</code> before the end of the frame.</li>
</ul>
<p>The following ordering constraints should resolve the issue.</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code>app.add_systems(
    PostUpdate,
    camera_follow_player
        .after(PhysicsSet::Sync)
        .before(TransformSystem::TransformPropagate),
);</code></pre></div>
<h4 id="is-there-a-character-controller"><a class="doc-anchor" href="#is-there-a-character-controller">§</a>Is there a character controller?</h4>
<p>Bevy XPBD does not have a built-in character controller, so if you need one,
you will need to implement it yourself. However, third party character controllers
like <a href="https://github.com/idanarye/bevy-tnua"><code>bevy_tnua</code></a> support Bevy XPBD, and <a href="https://github.com/PROMETHIA-27/bevy_mod_wanderlust"><code>bevy_mod_wanderlust</code></a>
and others are also likely to get Bevy XPBD support soon.</p>
<p>For custom character controllers, you can take a look at the
<a href="https://github.com/Jondolf/bevy_xpbd/tree/main/crates/bevy_xpbd_2d/examples/dynamic_character_2d"><code>dynamic_character_2d</code></a> and <a href="https://github.com/Jondolf/bevy_xpbd/tree/main/crates/bevy_xpbd_2d/examples/kinematic_character_2d"><code>kinematic_character_2d</code></a> examples to get started.</p>
<h4 id="why-are-there-separate-position-and-rotation-components"><a class="doc-anchor" href="#why-are-there-separate-position-and-rotation-components">§</a>Why are there separate <code>Position</code> and <code>Rotation</code> components?</h4>
<p>While <code>Transform</code> can be used for the vast majority of things, Bevy XPBD internally
uses separate <a href="components/struct.Position.html" title="struct bevy_xpbd_2d::components::Position"><code>Position</code></a> and <a href="components/struct.Rotation.html" title="struct bevy_xpbd_2d::components::Rotation"><code>Rotation</code></a> components. These are automatically
kept in sync by the <a href="plugins/sync/struct.SyncPlugin.html" title="struct bevy_xpbd_2d::plugins::sync::SyncPlugin"><code>SyncPlugin</code></a>.</p>
<p>There are several reasons why the separate components are currently used.</p>
<ul>
<li>Position and rotation should be global from the physics engine’s point of view.</li>
<li>Transform scale and shearing can cause issues and rounding errors in physics.</li>
<li>Transform hierarchies can be problematic.</li>
<li>There is no <code>f64</code> version of <code>Transform</code>.</li>
<li>There is no 2D version of <code>Transform</code> (yet), and having a 2D version can optimize several computations.</li>
<li>When position and rotation are separate, we can technically have more systems running in parallel.</li>
<li>Only rigid bodies have rotation, particles typically don’t (although we don’t make a distinction yet).</li>
</ul>
<p>In external projects however, using <a href="components/struct.Position.html" title="struct bevy_xpbd_2d::components::Position"><code>Position</code></a> and <a href="components/struct.Rotation.html" title="struct bevy_xpbd_2d::components::Rotation"><code>Rotation</code></a> is only necessary when you
need to manage positions in the <a href="struct.SubstepSchedule.html" title="struct bevy_xpbd_2d::SubstepSchedule"><code>SubstepSchedule</code></a>. Elsewhere, you should be able to use <code>Transform</code>.</p>
<p>There is also a possibility that we will revisit this if/when Bevy has a <code>Transform2d</code> component.
Using <code>Transform</code> feels more idiomatic and simple, so it would be nice if it could be used directly
as long as we can get around the drawbacks.</p>
<h4 id="can-the-engine-be-used-on-servers"><a class="doc-anchor" href="#can-the-engine-be-used-on-servers">§</a>Can the engine be used on servers?</h4>
<p>Yes! Networking often requires running the simulation in a specific schedule, and in Bevy XPBD you can
<a href="plugins/struct.PhysicsPlugins.html#custom-schedule" title="struct bevy_xpbd_2d::plugins::PhysicsPlugins">set the schedule that runs physics</a> and <a href="plugins/setup/struct.Physics.html" title="struct bevy_xpbd_2d::plugins::setup::Physics">configure the timestep</a>
to whatever you want.</p>
<p>One configuration is to run the client in <code>FixedUpdate</code>, and to use a fixed timestep for <a href="plugins/setup/struct.Physics.html" title="struct bevy_xpbd_2d::plugins::setup::Physics"><code>Time&lt;Physics&gt;</code></a>
on both the server and the client to make sure the physics simulation is only advanced by one step
each time the schedule runs.</p>
<p>Note that while Bevy XPBD should be locally deterministic, it can produce slightly different results on different
machines.</p>
<h4 id="something-else"><a class="doc-anchor" href="#something-else">§</a>Something else?</h4>
<p>Physics engines are very large and Bevy XPBD is young, so stability issues and bugs are to be expected.</p>
<p>If you encounter issues, please consider first taking a look at the
<a href="https://github.com/Jondolf/bevy_xpbd/issues">issues on GitHub</a> and
<a href="https://github.com/Jondolf/bevy_xpbd/issues/new">open a new issue</a> if there already isn’t one regarding your problem.</p>
<p>You can also come and say hello on the <a href="https://discord.com/invite/gMUk5Ph">Bevy Discord server</a>.
There you can find a bevy_xpbd thread on the crate-help channel where you can ask questions.</p>
<h3 id="what-is-xpbd"><a class="doc-anchor" href="#what-is-xpbd">§</a>What is XPBD?</h3>
<p><em>XPBD</em> or <em>Extended Position Based Dynamics</em> is a physics simulation method that extends
the traditional <em>PBD</em> to be more physically accurate and less dependent on time step size
and iteration count.</p>
<p>Unlike force or impulse based physics simulation methods, XPBD mostly operates at the position-level,
which can produce more stable and reliable results, while allowing straightforward coupling
of <a href="components/enum.RigidBody.html" title="enum bevy_xpbd_2d::components::RigidBody">rigid bodies</a>, soft bodies and fluids.</p>
<h4 id="simulation-loop"><a class="doc-anchor" href="#simulation-loop">§</a>Simulation loop</h4>
<p>At a high level, XPBD consists of a broad phase followed by a substepping loop that handles position
<a href="plugins/integrator/index.html" title="mod bevy_xpbd_2d::plugins::integrator">integration</a>, <a href="plugins/solver/index.html" title="mod bevy_xpbd_2d::plugins::solver">constraint solving</a>, velocity updates, and a velocity solver that
handles dynamic friction and restitution.</p>
<p>It looks roughly like this:</p>

<div class="example-wrap ignore"><a href="#" class="tooltip" title="This example is not tested">ⓘ</a><pre class="rust rust-example-rendered"><code><span class="kw">while </span>simulating:
    <span class="comment">// Substep size
    </span>h = ∆t / substep_count

    <span class="comment">// Broad phase
    </span>broad_collision_pairs = collect_collision_pairs()

    <span class="kw">for </span>substep_count:
        <span class="comment">// Integrate
        </span><span class="kw">for </span>n particles and bodies:
            <span class="comment">// Integrate position
            </span>x_prev = x
            v = v + h * f_ext / m
            x = x + h * v

            <span class="comment">// Integrate rotation
            </span>q_prev = q
            ω = ω + h * I^-<span class="number">1 </span>* (τ_ext - (ω x (I * ω)))
            q = q + h * <span class="number">0.5 </span>* [ω_x, ω_y, ω_z, <span class="number">0</span>] * q
            q = q / |q|

        <span class="comment">// Narrow phase
        </span><span class="kw">for </span>pair <span class="kw">in </span>broad_collision_pairs:
            compute_contacts(pair)

        <span class="comment">// Solve constraints (contacts, joints etc.)
        </span>solve_constraints(particles and bodies)

        <span class="comment">// Update velocities
        </span><span class="kw">for </span>n particles and bodies:
            v = (x - x_prev) / h
            ∆q = q * q_prev^-<span class="number">1
            </span>ω = <span class="number">2 </span>* [∆q_x, ∆q_y, ∆q_z] / h
            ω = ∆q_w &gt;= <span class="number">0 </span><span class="question-mark">? </span>ω : -ω

        <span class="comment">// Solve velocity constraints (dynamic friction and restitution)
        </span>solve_velocities(particles and bodies)</code></pre></div>
<p>where <code>h</code> is the substep size, <code>q</code> is the <a href="components/struct.Rotation.html" title="struct bevy_xpbd_2d::components::Rotation">rotation</a> as a quaternion,
<code>ω</code> is the <a href="components/struct.AngularVelocity.html" title="struct bevy_xpbd_2d::components::AngularVelocity">angular velocity</a>, <code>I</code> is the <a href="components/struct.Inertia.html" title="struct bevy_xpbd_2d::components::Inertia">angular inertia tensor</a> and <code>τ</code> is the
<a href="components/struct.ExternalTorque.html" title="struct bevy_xpbd_2d::components::ExternalTorque">external torque</a>.</p>
<p>In Bevy XPBD, the simulation loop is handled by various plugins. The <a href="plugins/setup/struct.PhysicsSetupPlugin.html" title="struct bevy_xpbd_2d::plugins::setup::PhysicsSetupPlugin"><code>PhysicsSetupPlugin</code></a> sets up
the Bevy schedules<sup id="fnref1"><a href="#fn1">1</a></sup><sup id="fnref2"><a href="#fn2">2</a></sup> and sets<sup id="fnref3"><a href="#fn3">3</a></sup><sup id="fnref4"><a href="#fn4">4</a></sup><sup id="fnref5"><a href="#fn5">5</a></sup>, the <a href="plugins/collision/broad_phase/struct.BroadPhasePlugin.html" title="struct bevy_xpbd_2d::plugins::collision::broad_phase::BroadPhasePlugin"><code>BroadPhasePlugin</code></a> manages the broad phase, the <a href="plugins/integrator/struct.IntegratorPlugin.html" title="struct bevy_xpbd_2d::plugins::integrator::IntegratorPlugin"><code>IntegratorPlugin</code></a>
handles XPBD integration, and so on. You can find all of the plugins and their responsibilities <a href="plugins/struct.PhysicsPlugins.html" title="struct bevy_xpbd_2d::plugins::PhysicsPlugins">here</a>.</p>
<h4 id="see-also"><a class="doc-anchor" href="#see-also">§</a>See also</h4>
<ul>
<li><a href="plugins/integrator/index.html" title="mod bevy_xpbd_2d::plugins::integrator">XPBD integration step</a></li>
<li><a href="constraints/index.html" title="mod bevy_xpbd_2d::constraints">Constraints and how to create them</a></li>
<li><a href="plugins/setup/struct.PhysicsSetupPlugin.html#schedules-and-sets" title="struct bevy_xpbd_2d::plugins::setup::PhysicsSetupPlugin">Schedules and sets used for the simulation loop</a></li>
</ul>
<h4 id="learning-resources"><a class="doc-anchor" href="#learning-resources">§</a>Learning resources</h4>
<p>If you want to learn more about XPBD, I recommend taking a look at some of the papers.
Especially the first one from 2020 was used heavily for the simulation loop and constraints in Bevy XPBD.</p>
<ul>
<li>XPBD: Müller M, Macklin M, Chentanez N, Jeschke S, Kim T. 2020. <em><a href="https://matthias-research.github.io/pages/publications/PBDBodies.pdf">Detailed Rigid Body Simulation with Extended Position Based Dynamics</a></em>.</li>
<li>XPBD: Macklin M, Müller M, Chentanez N. 2016. <em><a href="http://mmacklin.com/xpbd.pdf">XPBD: Position-Based Simulation of Compliant Constrained Dynamics</a></em>.</li>
</ul>
<p>The papers are quite academic, so you might instead prefer some videos and articles.
The first one by Ten Minute Physics (Matthias Müller, one of the XPBD researchers) is great for understanding
how XPBD differs from other simulation methods and how the constraints work.</p>
<ul>
<li>Video: Ten Minute Physics. 2022. <em><a href="https://youtu.be/jrociOAYqxA">Getting ready to simulate the world with XPBD</a></em>.</li>
<li>Notes: Nolan Tait. <em><a href="https://taintedcoders.com/bevy/xpbd/">Bevy Physics: XPBD</a></em>.</li>
<li>Tutorial series: Johan Helsing. <em><a href="https://johanhelsing.studio/posts/bevy-xpbd">Tutorial: Making a physics engine with Bevy</a></em>.
(inspired this project)</li>
</ul>
<h3 id="license"><a class="doc-anchor" href="#license">§</a>License</h3>
<p>Bevy XPBD is free and open source. All code in the Bevy XPBD repository is dual-licensed under either:</p>
<ul>
<li>MIT License (<a href="https://github.com/Jondolf/bevy_xpbd/blob/main/LICENSE-MIT">LICENSE-MIT</a>
or <a href="http://opensource.org/licenses/MIT">http://opensource.org/licenses/MIT</a>)</li>
<li>Apache License, Version 2.0 (<a href="https://github.com/Jondolf/bevy_xpbd/blob/main/LICENSE-APACHE">LICENSE-APACHE</a>
or <a href="http://www.apache.org/licenses/LICENSE-2.0">http://www.apache.org/licenses/LICENSE-2.0</a>)</li>
</ul>
<p>at your option.</p>
<div class="footnotes"><hr><ol><li id="fn1"><p><a href="struct.PhysicsSchedule.html" title="struct bevy_xpbd_2d::PhysicsSchedule"><code>PhysicsSchedule</code></a>&nbsp;<a href="#fnref1">↩</a></p></li><li id="fn2"><p><a href="struct.SubstepSchedule.html" title="struct bevy_xpbd_2d::SubstepSchedule"><code>SubstepSchedule</code></a>&nbsp;<a href="#fnref2">↩</a></p></li><li id="fn3"><p><a href="enum.PhysicsSet.html" title="enum bevy_xpbd_2d::PhysicsSet"><code>PhysicsSet</code></a>&nbsp;<a href="#fnref3">↩</a></p></li><li id="fn4"><p><a href="enum.PhysicsStepSet.html" title="enum bevy_xpbd_2d::PhysicsStepSet"><code>PhysicsStepSet</code></a>&nbsp;<a href="#fnref4">↩</a></p></li><li id="fn5"><p><a href="enum.SubstepSet.html" title="enum bevy_xpbd_2d::SubstepSet"><code>SubstepSet</code></a>&nbsp;<a href="#fnref5">↩</a></p></li></ol></div></div></details><h2 id="reexports" class="section-header">Re-exports<a href="#reexports" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><code>pub extern crate <a class="mod" href="../parry2d/index.html" title="mod parry2d">parry2d</a> as parry;</code></div></li></ul><h2 id="modules" class="section-header">Modules<a href="#modules" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="mod" href="components/index.html" title="mod bevy_xpbd_2d::components">components</a></div><div class="desc docblock-short">Commonly used components.</div></li><li><div class="item-name"><a class="mod" href="constraints/index.html" title="mod bevy_xpbd_2d::constraints">constraints</a></div><div class="desc docblock-short">Contains constraints used by the <a href="plugins/solver/index.html" title="mod bevy_xpbd_2d::plugins::solver">solver</a>.</div></li><li><div class="item-name"><a class="mod" href="math/index.html" title="mod bevy_xpbd_2d::math">math</a></div><div class="desc docblock-short">Math types and traits used in the crate. Most of the math types are feature-dependent, so they will
be different for <code>2d</code>/<code>3d</code> and <code>f32</code>/<code>f64</code>.</div></li><li><div class="item-name"><a class="mod" href="plugins/index.html" title="mod bevy_xpbd_2d::plugins">plugins</a></div><div class="desc docblock-short">The building blocks of Bevy XPBD.</div></li><li><div class="item-name"><a class="mod" href="prelude/index.html" title="mod bevy_xpbd_2d::prelude">prelude</a></div><div class="desc docblock-short">Re-exports common components, bundles, resources, plugins and types.</div></li><li><div class="item-name"><a class="mod" href="resources/index.html" title="mod bevy_xpbd_2d::resources">resources</a></div><div class="desc docblock-short">Resources used in the simulation.</div></li></ul><h2 id="structs" class="section-header">Structs<a href="#structs" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="struct" href="struct.PhysicsSchedule.html" title="struct bevy_xpbd_2d::PhysicsSchedule">PhysicsSchedule</a></div><div class="desc docblock-short">Responsible for advancing the physics simulation. This is run in <a href="enum.PhysicsSet.html#variant.StepSimulation" title="variant bevy_xpbd_2d::PhysicsSet::StepSimulation"><code>PhysicsSet::StepSimulation</code></a>.</div></li><li><div class="item-name"><a class="struct" href="struct.PostProcessCollisions.html" title="struct bevy_xpbd_2d::PostProcessCollisions">PostProcessCollisions</a></div><div class="desc docblock-short">A schedule where you can add systems to filter or modify collisions
using the <a href="plugins/collision/struct.Collisions.html" title="struct bevy_xpbd_2d::plugins::collision::Collisions"><code>Collisions</code></a> resource.</div></li><li><div class="item-name"><a class="struct" href="struct.SubstepSchedule.html" title="struct bevy_xpbd_2d::SubstepSchedule">SubstepSchedule</a></div><div class="desc docblock-short">The substepping schedule that runs in <a href="enum.PhysicsStepSet.html#variant.Substeps" title="variant bevy_xpbd_2d::PhysicsStepSet::Substeps"><code>PhysicsStepSet::Substeps</code></a>.
The number of substeps per physics step is configured through the <a href="resources/struct.SubstepCount.html" title="struct bevy_xpbd_2d::resources::SubstepCount"><code>SubstepCount</code></a> resource.</div></li></ul><h2 id="enums" class="section-header">Enums<a href="#enums" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="enum" href="enum.PhysicsSet.html" title="enum bevy_xpbd_2d::PhysicsSet">PhysicsSet</a></div><div class="desc docblock-short">High-level system sets for the main phases of the physics engine.
You can use these to schedule your own systems before or after physics is run without
having to worry about implementation details.</div></li><li><div class="item-name"><a class="enum" href="enum.PhysicsStepSet.html" title="enum bevy_xpbd_2d::PhysicsStepSet">PhysicsStepSet</a></div><div class="desc docblock-short">System sets for the main steps in the physics simulation loop. These are typically run in the <a href="struct.PhysicsSchedule.html" title="struct bevy_xpbd_2d::PhysicsSchedule"><code>PhysicsSchedule</code></a>.</div></li><li><div class="item-name"><a class="enum" href="enum.SubstepSet.html" title="enum bevy_xpbd_2d::SubstepSet">SubstepSet</a></div><div class="desc docblock-short">System sets for the the steps in the inner substepping loop. These are typically run in the <a href="struct.SubstepSchedule.html" title="struct bevy_xpbd_2d::SubstepSchedule"><code>SubstepSchedule</code></a>.</div></li></ul></section></div></main></body></html>